<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾ä»£å†¥æƒ³å€’æ•¸è¨ˆæ™‚å™¨</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Tone.js ç”¨æ–¼æ’­æ”¾æç¤ºéŸ³ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* å®šç¾©è·³å‹•å‹•ç•« (Thumping Animation) */
        @keyframes thump {
            0%, 100% { transform: scale(1.0); }
            50% { transform: scale(1.02); }
        }
        /* å¥—ç”¨è·³å‹•å‹•ç•«å’ŒæŸ”å’Œé™°å½±ï¼Œä½¿å…¶çœ‹èµ·ä¾†åƒåœ¨è„ˆå‹• */
        .thumping-animation {
            animation: thump 1.5s ease-in-out infinite;
            box-shadow: 0 0 50px rgba(192, 132, 252, 0.8); /* ç´«è‰²æŸ”å’Œå…‰æšˆ */
        }

        /* è¨­å®šå­—é«”å’ŒèƒŒæ™¯æ¼¸å±¤ */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); /* è—è‰²è‡³ç´«è‰²æ¼¸å±¤ */
            transition: background-color 0.5s ease;
        }

        /* éš±è—åŸç”Ÿ focus è¼ªå»“ï¼Œä½¿ç”¨è‡ªå®šç¾©æ¨£å¼ */
        button:focus {
            outline: none;
        }

        /* ç¢ºä¿è¡Œå‹•è£ç½®ä¸Šæœ‰è‰¯å¥½çš„è§¸æ§ç›®æ¨™å¤§å° */
        .control-button {
            min-width: 120px;
            padding: 1rem 2rem;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="timer-card" class="w-full max-w-xl p-6 sm:p-10 rounded-3xl shadow-2xl bg-white/10 backdrop-blur-sm border border-white/20 transition-all duration-500">
        
        <h1 id="title-text" class="text-xl sm:text-3xl font-light text-white text-center mb-8 tracking-wider transition-opacity duration-500 opacity-90">
            å†¥æƒ³è¨ˆæ™‚å™¨
        </h1>

        <!-- æ™‚é–“é¡¯ç¤ºå€å¡Š -->
        <div id="time-display" class="text-7xl sm:text-9xl font-extrabold text-white text-center select-none tracking-tighter cursor-default transition-all duration-300">
            15:00
        </div>
        
        <!-- ç‹€æ…‹è¨Šæ¯ -->
        <p id="status-message" class="text-lg text-white text-center mt-4 h-6 opacity-0 transition-opacity duration-500">
            <!-- ç‹€æ…‹è¨Šæ¯å°‡é¡¯ç¤ºåœ¨æ­¤ (ä¾‹å¦‚: "å†¥æƒ³çµæŸ!") -->
        </p>

        <!-- é è¨­æ™‚é–“æŒ‰éˆ• -->
        <div class="flex flex-wrap justify-center gap-3 mt-10">
            <button data-duration="900" class="preset-btn text-xs sm:text-sm px-4 py-2 rounded-full border border-white/50 text-white hover:bg-white/20 transition duration-200">15 åˆ†é˜</button>
            <button data-duration="600" class="preset-btn text-xs sm:text-sm px-4 py-2 rounded-full border border-white/50 text-white hover:bg-white/20 transition duration-200">10 åˆ†é˜</button>
            <button data-duration="1800" class="preset-btn text-xs sm:text-sm px-4 py-2 rounded-full border border-white/50 text-white hover:bg-white/20 transition duration-200">30 åˆ†é˜</button>
            <button data-duration="3600" class="preset-btn text-xs sm:text-sm px-4 py-2 rounded-full border border-white/50 text-white hover:bg-white/20 transition duration-200">60 åˆ†é˜</button>
        </div>

        <!-- æŒ‰éˆ•ä¾†åˆ‡æ›è‡ªå®šç¾©è¼¸å…¥ -->
        <div class="flex justify-center mt-6 mb-4">
            <button id="toggle-custom-btn" class="text-white/80 hover:text-white text-sm font-light underline transition duration-200">
                æˆ–è¨­å®šè‡ªå®šç¾©æ™‚é–“
            </button>
        </div>

        <!-- è‡ªå®šç¾©æ™‚é–“è¼¸å…¥å€å¡Š (é è¨­éš±è—) - åŠ å…¥äº†ç§’æ•¸è¼¸å…¥ -->
        <div id="custom-input-container" class="mb-8 p-4 rounded-xl bg-white/10 hidden">
            <label class="text-white text-sm block mb-2">è¨­å®šè‡ªå®šç¾©æ™‚é–“:</label>
            <div class="flex gap-2 items-center">
                <!-- åˆ†é˜è¼¸å…¥ -->
                <input type="number" id="custom-minutes" min="0" max="360" value="15" class="w-1/3 p-3 rounded-lg text-lg text-indigo-800 bg-white/80 focus:ring-2 focus:ring-indigo-300 focus:outline-none" aria-label="è‡ªå®šç¾©åˆ†é˜æ•¸">
                <span class="text-white text-base">åˆ†</span>
                <!-- ç§’æ•¸è¼¸å…¥ -->
                <input type="number" id="custom-seconds" min="0" max="59" value="0" class="w-1/3 p-3 rounded-lg text-lg text-indigo-800 bg-white/80 focus:ring-2 focus:ring-indigo-300 focus:outline-none" aria-label="è‡ªå®šç¾©ç§’æ•¸">
                <span class="text-white text-base">ç§’</span>
                <button id="set-custom-btn" class="bg-indigo-500 text-white px-3 py-3 rounded-lg hover:bg-indigo-600 transition duration-200 transform hover:scale-105 active:scale-95 whitespace-nowrap">è¨­å®š</button>
            </div>
        </div>

        <!-- ä¸»è¦æ§åˆ¶æŒ‰éˆ•å€å¡Š -->
        <div class="flex flex-wrap justify-center gap-4 mt-6">
            <button id="start-pause-btn" 
                    class="control-button bg-white text-indigo-600 hover:bg-indigo-100 font-semibold rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 active:scale-95 focus:ring-4 focus:ring-indigo-300">
                é–‹å§‹
            </button>
            <button id="reset-btn" 
                    class="control-button bg-transparent border border-white text-white hover:bg-white/20 font-semibold rounded-full shadow-md transition-all duration-300 transform hover:scale-105 active:scale-95 focus:ring-4 focus:ring-white/50"
                    disabled>
                é‡è¨­
            </button>
        </div>

    </div>

    <script>
        // è¨­å®šå…¨åŸŸè®Šæ•¸
        const initialDefaultDuration = 15 * 60; // é è¨­çš„åˆå§‹é•·åº¦ (15 åˆ†é˜)
        let currentDuration = initialDefaultDuration; // ç•¶å‰è¨­å®šçš„è¨ˆæ™‚é•·åº¦ï¼ˆç§’ï¼‰
        let countdownSeconds = currentDuration;
        let timerInterval = null;
        let isRunning = false;
        let isFinished = false;

        // å–å¾— DOM å…ƒç´ 
        const timeDisplay = document.getElementById('time-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timerCard = document.getElementById('timer-card');
        const statusMessage = document.getElementById('status-message');
        const titleText = document.getElementById('title-text');
        
        const presetButtons = document.querySelectorAll('.preset-btn');
        const toggleCustomBtn = document.getElementById('toggle-custom-btn');
        const customInputContainer = document.getElementById('custom-input-container');
        const customMinutesInput = document.getElementById('custom-minutes');
        // æ–°å¢ç§’æ•¸è¼¸å…¥æ¬„ä½
        const customSecondsInput = document.getElementById('custom-seconds');
        const setCustomBtn = document.getElementById('set-custom-btn');

        // åˆå§‹åŒ– Tone.js ç°¡æ˜“åˆæˆå™¨ï¼Œç”¨æ–¼ç™¼å‡ºä½æ²‰æç¤ºéŸ³
        const synth = new Tone.Synth().toDestination();

        /**
         * å°‡ç§’æ•¸è½‰æ›ç‚º M:SS æ ¼å¼çš„å­—ä¸² (æˆ– H:MM:SS å¦‚æœè¶…éä¸€å°æ™‚)
         * @param {number} totalSeconds - ç¸½ç§’æ•¸
         * @returns {string} æ ¼å¼åŒ–å¾Œçš„æ™‚é–“å­—ä¸²
         */
        function formatTime(totalSeconds) {
            const absSeconds = Math.abs(totalSeconds);
            const hours = Math.floor(absSeconds / 3600);
            const minutes = Math.floor((absSeconds % 3600) / 60);
            const seconds = absSeconds % 60;
            
            const paddedSeconds = seconds.toString().padStart(2, '0');
            const paddedMinutes = minutes.toString().padStart(2, '0');

            if (hours > 0) {
                return `${hours}:${paddedMinutes}:${paddedSeconds}`;
            }
            return `${minutes}:${paddedSeconds}`;
        }

        /**
         * æ›´æ–°ç•«é¢ä¸Šçš„æ™‚é–“é¡¯ç¤ºå’ŒæŒ‰éˆ•ç‹€æ…‹
         */
        function updateDisplay() {
            timeDisplay.textContent = formatTime(countdownSeconds);

            if (countdownSeconds <= 0 && !isFinished) {
                completeTimer();
            }

            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            if (isRunning) {
                startPauseBtn.textContent = 'æš«åœ';
                resetBtn.disabled = false;
            } else if (isFinished) {
                startPauseBtn.textContent = 'å®Œæˆ';
                startPauseBtn.disabled = true;
                resetBtn.disabled = false;
            } else {
                startPauseBtn.textContent = (countdownSeconds === currentDuration) ? 'é–‹å§‹' : 'ç¹¼çºŒ';
                resetBtn.disabled = (countdownSeconds === currentDuration);
            }
        }

        /**
         * é–‹å§‹æˆ–ç¹¼çºŒè¨ˆæ™‚å™¨
         */
        function startTimer() {
            if (isRunning || isFinished) return;
            // ç¢ºä¿è¨ˆæ™‚å™¨æœ‰æœ‰æ•ˆçš„æ™‚é–“é•·åº¦
            if (currentDuration <= 0) {
                statusMessage.textContent = 'è«‹è¨­å®šæœ‰æ•ˆçš„æ™‚é–“ï¼';
                statusMessage.classList.add('opacity-100', 'text-yellow-300');
                return;
            }


            isRunning = true;
            timerCard.classList.remove('thumping-animation');
            statusMessage.classList.remove('opacity-100', 'text-yellow-300');
            statusMessage.textContent = '';
            titleText.classList.add('opacity-100');

            timerInterval = setInterval(() => {
                countdownSeconds--;
                updateDisplay();
                if (countdownSeconds <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
            updateDisplay();
        }

        /**
         * æš«åœè¨ˆæ™‚å™¨
         */
        function pauseTimer() {
            if (!isRunning) return;

            isRunning = false;
            clearInterval(timerInterval);
            updateDisplay();
        }

        /**
         * è¨­å®šæ–°çš„è¨ˆæ™‚é•·åº¦ä¸¦é‡è¨­è¨ˆæ™‚å™¨ç‹€æ…‹
         * @param {number} newDuration - ä»¥ç§’ç‚ºå–®ä½çš„æ–°é•·åº¦
         */
        function setDuration(newDuration) {
            // æª¢æŸ¥æ–°é•·åº¦æ˜¯å¦æœ‰æ•ˆä¸”å¤§æ–¼ 0
            if (newDuration <= 0) return;

            // åœæ­¢è¨ˆæ™‚
            clearInterval(timerInterval);

            // ç¢ºä¿åœ¨é‡è¨­æ™‚åœæ­¢ä»»ä½•å¯èƒ½çš„æ®˜éŸ¿éŸ³
            if (synth) {
                // ä½¿ç”¨ triggerRelease åœæ­¢ä»»ä½•æ­£åœ¨æ’­æ”¾çš„è²éŸ³
                synth.triggerRelease();
            }

            // æ›´æ–°é•·åº¦è®Šæ•¸
            currentDuration = newDuration;
            countdownSeconds = currentDuration;
            isRunning = false;
            isFinished = false;

            // æ›´æ–°æ¨™é¡Œ
            const minutes = Math.floor(newDuration / 60);
            titleText.textContent = `å†¥æƒ³è¨ˆæ™‚å™¨ (${minutes} åˆ†é˜)`;
            
            // æ¸…é™¤å‹•ç•«å’Œç‹€æ…‹è¨Šæ¯
            timerCard.classList.remove('thumping-animation');
            statusMessage.classList.remove('opacity-100', 'text-yellow-300');
            statusMessage.textContent = '';
            titleText.classList.add('opacity-100');
            startPauseBtn.disabled = false;

            updateDisplay();
        }
        
        /**
         * é‡è¨­è¨ˆæ™‚å™¨ (ä½¿ç”¨ currentDuration)
         */
        function resetTimer() {
            setDuration(currentDuration);
        }


        /**
         * è¨ˆæ™‚å®Œæˆè™•ç†
         */
        function completeTimer() {
            isFinished = true;
            isRunning = false;
            
            // æ’­æ”¾ä½æ²‰æç¤ºéŸ³ (å–®éŸ³ G4)
            try {
                // Tone.js éœ€è¦åœ¨ä½¿ç”¨è€…äº’å‹•å¾Œæ‰èƒ½å•Ÿå‹• AudioContext
                if (Tone.context.state !== 'running') {
                    Tone.start();
                }
                const now = Tone.now();
                const duration = "0.7"; // è²éŸ³é•·åº¦
                
                // ã€å·²ä¿®æ­£ã€‘ä½¿ç”¨ triggerAttackRelease ç¢ºä¿è²éŸ³æœƒåœ¨å–®éŸ³åˆæˆå™¨ä¸Šæ­£ç¢ºæ’­æ”¾å’Œåœæ­¢
                synth.triggerAttackRelease("G4", duration, now);

            } catch (e) {
                console.error("ç„¡æ³•æ’­æ”¾è²éŸ³:", e);
                // å¿½ç•¥éŒ¯èª¤ï¼Œè®“è¨ˆæ™‚å™¨ç¹¼çºŒé‹ä½œ
            }

            // æ‡‰ç”¨è·³å‹•å‹•ç•«
            timerCard.classList.add('thumping-animation');
            
            // é¡¯ç¤ºå®Œæˆè¨Šæ¯
            statusMessage.textContent = 'å†¥æƒ³çµæŸï¼ğŸ§˜';
            statusMessage.classList.add('opacity-100');
            titleText.classList.remove('opacity-100');


            updateDisplay();
        }

        // --- äº‹ä»¶ç›£è½å™¨ ---

        /**
         * è™•ç†é–‹å§‹/æš«åœæŒ‰éˆ•é»æ“Š
         */
        startPauseBtn.addEventListener('click', () => {
            if (isRunning) {
                pauseTimer();
            } else if (!isFinished) {
                startTimer();
            }
        });

        /**
         * è™•ç†é‡è¨­æŒ‰éˆ•é»æ“Š
         */
        resetBtn.addEventListener('click', resetTimer);
        
        /**
         * è™•ç†é è¨­æ™‚é–“æŒ‰éˆ•é»æ“Š
         */
        presetButtons.forEach(button => {
            button.addEventListener('click', function() {
                const durationSeconds = parseInt(this.dataset.duration);
                setDuration(durationSeconds);
                // ç¢ºä¿åœ¨è¨­å®šæ–°æ™‚é–“æ™‚ï¼Œcustom input éš±è—
                customInputContainer.classList.add('hidden');
                toggleCustomBtn.textContent = 'æˆ–è¨­å®šè‡ªå®šç¾©æ™‚é–“';
            });
        });

        /**
         * è™•ç†åˆ‡æ›è‡ªå®šç¾©è¼¸å…¥æŒ‰éˆ•é»æ“Š
         */
        toggleCustomBtn.addEventListener('click', () => {
            const isHidden = customInputContainer.classList.toggle('hidden');
            toggleCustomBtn.textContent = isHidden ? 'æˆ–è¨­å®šè‡ªå®šç¾©æ™‚é–“' : 'éš±è—è‡ªå®šç¾©è¨­å®š';
        });

        /**
         * è™•ç†è¨­å®šè‡ªå®šç¾©æ™‚é–“æŒ‰éˆ•é»æ“Š
         */
        setCustomBtn.addEventListener('click', () => {
            // å¾è¼¸å…¥æ¬„ä½å–å¾—åˆ†é˜æ•¸å’Œç§’æ•¸
            const minutes = parseInt(customMinutesInput.value || 0); // è‹¥ç©ºç™½å‰‡è¦–ç‚º 0
            const seconds = parseInt(customSecondsInput.value || 0); // è‹¥ç©ºç™½å‰‡è¦–ç‚º 0

            const totalDuration = (minutes * 60) + seconds;

            // é©—è­‰è¼¸å…¥ï¼šè‡³å°‘æœ‰ä¸€ç§’ï¼Œä¸”åˆ†é˜æ•¸ä¸è¶…é 360ï¼Œç§’æ•¸ä¸è¶…é 59
            if (totalDuration > 0 && minutes >= 0 && minutes <= 360 && seconds >= 0 && seconds < 60) {
                setDuration(totalDuration);
                // éš±è—è¼¸å…¥æ¡†
                customInputContainer.classList.add('hidden');
                toggleCustomBtn.textContent = 'æˆ–è¨­å®šè‡ªå®šç¾©æ™‚é–“';

            } else {
                // éŒ¯èª¤è™•ç†
                let message = 'è«‹è¼¸å…¥ 1 ç§’åˆ° 360 åˆ†é˜å…§çš„æ™‚é–“ï¼';
                
                // æ¸…é™¤èˆŠçš„éŒ¯èª¤é‚Šæ¡†
                customMinutesInput.classList.remove('border-red-500', 'border-2');
                customSecondsInput.classList.remove('border-red-500', 'border-2');

                // æ¨™ç¤ºéŒ¯èª¤æ¬„ä½
                if (totalDuration <= 0) {
                     customMinutesInput.classList.add('border-red-500', 'border-2');
                     customSecondsInput.classList.add('border-red-500', 'border-2');
                } else if (minutes > 360) {
                     customMinutesInput.classList.add('border-red-500', 'border-2');
                     message = 'åˆ†é˜æ•¸ä¸å¾—è¶…é 360ï¼';
                } else if (seconds >= 60 || seconds < 0) {
                     customSecondsInput.classList.add('border-red-500', 'border-2');
                     message = 'ç§’æ•¸å¿…é ˆåœ¨ 0 åˆ° 59 ä¹‹é–“ï¼';
                }

                statusMessage.textContent = message;
                statusMessage.classList.add('opacity-100', 'text-yellow-300');
                
                // éŒ¯èª¤è¨Šæ¯çŸ­æš«é¡¯ç¤ºå¾Œç§»é™¤
                setTimeout(() => {
                    customMinutesInput.classList.remove('border-red-500', 'border-2');
                    customSecondsInput.classList.remove('border-red-500', 'border-2');
                    statusMessage.classList.remove('opacity-100', 'text-yellow-300');
                    statusMessage.textContent = '';
                }, 3000);
            }
        });


        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–é¡¯ç¤º
        window.onload = () => setDuration(initialDefaultDuration);

    </script>
</body>
</html>